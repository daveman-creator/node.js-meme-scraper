import client from 'node:https';
// 0. Import all the required packages
import axios from 'axios';
import * as cheerio from 'cheerio';
import fs from 'fs';
import Json from 'Json';
import querystring from 'querystring';

//creat a Write Stream
const filepath = './memes';

const htmlContent = 'https://memegen-link-examples-upleveled.netlify.app/';
const response = await fetch(htmlContent);
const body = await response.text();
console.log(body);

axios(htmlContent).then((response) => {
  const html = response.data;
  const $ = cheerio.load(html);
  const memesArray = [];

  $('div', 'section', html).each(function () {
    const imgSrc = $(this).find('img').attr('src');
    memesArray.push(imgSrc);
  });
  const memes = memesArray.slice(0, 10);
  const maplinks = memes.map((mem) => mem.imgSrc);
  console.log(memes);

  for (let i = 0; i < memesArray.length; i++) {
    client.get(memesArray[i], (res) => {
      if (i < 9) {
        const dir = `./memes/0${i + 1}.jpg`;
        res.pipe(fs.createWriteStream(dir));
      } else {
        const dir = `./memes/${i + 1}.jpg`;
        res.pipe(fs.createWriteStream(dir));
      }
    });
  }
});
console.log('Download finished');

// catch (err) {
//   console.error(err);}

// Invoke the above function
await scrapeData();
